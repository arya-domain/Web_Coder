<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Humanize Text</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }

        .container {
            display: flex;
            gap: 20px;
            align-items: start;
        }

        .box {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        textarea,
        #output {
            width: 100%;
            min-height: 300px;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: #fff;
            resize: vertical;
            white-space: pre-wrap;
        }

        .controls {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        button {
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
        }

        .similarity {
            font-weight: bold;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>

<body>
    <h2>Humanize Text</h2>
    <form id="humanizeForm">
        <div class="container">
            <div class="box">
                <label><strong>Input Text</strong></label>
                <textarea name="aiText" id="inputText" placeholder="Enter text..."></textarea>
                <div class="controls">
                    <button type="button" onclick="copyText('inputText')">Copy Input</button>
                </div>
            </div>

            <div class="box">
                <label><strong>Humanized Output</strong></label>
                <div id="output" contenteditable="true">Waiting for output...</div>
                <div class="controls">
                    <button type="button" onclick="copyText('output')">Copy Output</button>
                </div>
            </div>
        </div>

        <br>
        <button type="submit">Submit</button>
        <p class="similarity" id="similarity">Similarity: --</p>
    </form>

    <script>
        document.getElementById("humanizeForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const responseDiv = document.getElementById("output");
            const inputText = document.getElementById("inputText").value;
            const simDiv = document.getElementById("similarity");

            responseDiv.textContent = "Processing...";
            simDiv.textContent = "Similarity: --";

            try {
                const res = await fetch("/humanize", {
                    method: "POST",
                    body: formData
                });

                const data = await res.json();

                if (data.error !== "No") {
                    responseDiv.textContent = "Error: " + data.error;
                } else {
                    responseDiv.textContent = data.message || "No message returned.";
                    const similarity = calculateSimilarity(inputText, data.message);
                    simDiv.textContent = "Similarity: " + similarity.toFixed(2) + "%";
                }
            } catch (err) {
                responseDiv.textContent = "Request failed: " + err;
            }
        });

        function copyText(id) {
            const el = document.getElementById(id);
            const text = el.value || el.innerText;

            navigator.clipboard.writeText(text).then(() => {
                alert("Copied!");
            });
        }

        function calculateSimilarity(a, b) {
            const tokenize = text =>
                text.toLowerCase().replace(/[^\w\s]/g, "").split(/\s+/);
            const vec = arr =>
                arr.reduce((acc, word) => {
                    acc[word] = (acc[word] || 0) + 1;
                    return acc;
                }, {});
            const dot = (v1, v2) =>
                Object.keys(v1).reduce((sum, key) => sum + (v1[key] * (v2[key] || 0)), 0);
            const mag = v => Math.sqrt(Object.values(v).reduce((sum, val) => sum + val * val, 0));

            const vecA = vec(tokenize(a));
            const vecB = vec(tokenize(b));
            const similarity = (dot(vecA, vecB) / (mag(vecA) * mag(vecB))) || 0;
            return similarity * 100;
        }
    </script>
</body>

</html>